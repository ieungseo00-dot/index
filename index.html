<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- ê³µìœ  ì •ë³´ -->
    <meta property="og:title" content="2025 ìŠ¤ë§ˆíŠ¸ ê°€ê³„ë¶€">
    <meta property="og:description" content="ê³µíœ´ì¼ ì˜ˆì‚° & ê³ ì •ì§€ì¶œ ê´€ë¦¬ê¹Œì§€ ë˜ëŠ” ë˜‘ë˜‘í•œ ê°€ê³„ë¶€">
    <meta property="og:type" content="website">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’¸</text></svg>">

    <title>2025 ìŠ¤ë§ˆíŠ¸ ê°€ê³„ë¶€</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-color: #F2F4F6;
            --card-bg: #ffffff;
            --primary-color: #3182f6;
            --text-main: #191f28;
            --text-sub: #8b95a1;
            --danger: #ef4444;
            --success: #22c55e;
            --radius: 16px;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            --holiday-color: #FF6B6B;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ëª¨ë“  ì…ë ¥/ë²„íŠ¼ í°íŠ¸ í†µì¼ */
        input,
        select,
        button {
            font-family: inherit;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        /* ìƒë‹¨ ë„¤ë¹„ */
        #top-bar {
            height: 56px;
            background: var(--card-bg);
            padding: 0 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 50;
            flex-shrink: 0;
            border-bottom: 1px solid #eee;
        }

        #month-scroll-area {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding: 4px 0;
            flex: 1;
            margin-right: 10px;
        }

        .month-btn {
            padding: 6px 12px;
            border-radius: 16px;
            border: none;
            background: transparent;
            color: var(--text-sub);
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .month-btn.active {
            background: var(--text-main);
            color: white;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        #main-container {
            flex: 1;
            display: flex;
            gap: 16px;
            padding: 16px;
            overflow-y: auto;
            max-width: 1100px;
            margin: 0 auto;
            width: 100%;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            margin-bottom: 16px;
        }

        #left-panel {
            flex: 1.4;
            display: flex;
            flex-direction: column;
        }

        #right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 300px;
        }

        /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        #calendar-header {
            font-size: 1.1rem;
            font-weight: 800;
            margin-bottom: 15px;
            text-align: center;
        }

        #calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            row-gap: 8px;
            text-align: center;
        }

        .cal-day-name {
            font-size: 0.8rem;
            color: var(--text-sub);
            margin-bottom: 5px;
        }

        .cal-date {
            height: 34px;
            width: 34px;
            line-height: 34px;
            margin: 0 auto;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            position: relative;
        }

        .cal-date.selected {
            background: var(--text-main);
            color: white;
            font-weight: 700;
        }

        .cal-date.holiday {
            color: var(--danger);
            font-weight: bold;
        }

        .cal-date.has-event::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--primary-color);
            border-radius: 50%;
        }

        .cal-date.holiday.has-event::after {
            background: var(--holiday-color);
        }

        .cal-date.selected.has-event::after {
            background: white;
        }

        /* ê³µíœ´ì¼ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .holiday-box {
            background: #FFF0F0;
            border: 1px solid #FFCDD2;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            position: relative;
        }

        .holiday-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .holiday-title {
            font-weight: bold;
            color: #D63031;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .holiday-date-badge {
            font-size: 0.75rem;
            background: #ff7675;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
        }

        .holiday-progress {
            height: 6px;
            background: #FFCDD2;
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }

        .holiday-bar {
            height: 100%;
            background: #D63031;
            width: 0%;
            transition: 0.3s;
        }

        .holiday-stat {
            font-size: 0.8rem;
            color: #555;
            display: flex;
            justify-content: space-between;
        }

        .h-input-area {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .h-input {
            border: 1px solid #ffcdd2;
            padding: 4px;
            border-radius: 6px;
            width: 80px;
            font-size: 0.8rem;
        }

        .h-btn {
            background: #D63031;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        /* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .ledger-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f5f5f5;
            font-size: 0.95rem;
        }

        .amt-inc {
            color: var(--danger);
            font-weight: bold;
        }

        .amt-exp {
            color: var(--text-main);
            font-weight: bold;
        }

        /* ëª©í‘œ ë°” */
        .goal-bar-bg {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 6px;
        }

        .goal-bar-fill {
            height: 100%;
            width: 0%;
            background: var(--success);
            transition: 0.6s ease;
        }

        /* í•˜ë‹¨ ì˜ì—­ */
        #bottom-wrapper {
            background: var(--card-bg);
            border-top: 1px solid #eee;
            flex-shrink: 0;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
        }

        /* ê³ ì •ì§€ì¶œ ê´€ë¦¬ ë°” + ê°œë³„ í‚¤ */
        #fixed-manage-bar {
            padding: 8px 16px;
            background: #F9FAFB;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-sub);
        }

        #fixed-quick-row {
            padding: 6px 16px 0 16px;
            display: flex;
            gap: 6px;
            overflow-x: auto;
        }

        .fixed-chip {
            padding: 4px 10px;
            border-radius: 999px;
            background: #edf2ff;
            color: #1f3bb3;
            border: none;
            font-size: 0.8rem;
            cursor: pointer;
            white-space: nowrap;
        }

        /* ì…ë ¥ í¼ */
        #input-form {
            display: flex;
            gap: 8px;
            padding: 8px 16px 12px 16px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input-box {
            background: #F2F4F6;
            border-radius: 10px;
            padding: 0 10px;
            height: 42px;
            border: none;
            outline: none;
            font-size: 0.9rem;
        }

        .btn-submit {
            height: 42px;
            padding: 0 16px;
            background: var(--text-main);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            #main-container {
                flex-direction: column;
                padding: 10px;
            }

            #left-panel,
            #right-panel {
                flex: none;
                width: 100%;
            }

            #input-form {
                flex-direction: column;
                align-items: stretch;
            }

            #input-form .input-box {
                width: 100% !important;
            }

            .btn-submit {
                width: 100%;
            }
        }

        /* ëª¨ë‹¬ ê³µí†µ */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }

        .center-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 320px;
            text-align: center;
        }

        .modal-list {
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            margin-bottom: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }

        .modal-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #f9f9f9;
        }

        .modal-btn {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            background: var(--text-main);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <!-- ìƒë‹¨ -->
    <div id="top-bar">
        <div id="month-scroll-area"></div>
        <button onclick="resetData()" style="border:none; background:none; font-size:1.2rem;">â†»</button>
    </div>

    <!-- ë©”ì¸ -->
    <div id="main-container">
        <!-- ì™¼ìª½: ë‹¬ë ¥ + ë‚´ì—­ -->
        <div id="left-panel">
            <div class="card">
                <div id="calendar-header"></div>
                <div id="calendar-grid"></div>
            </div>
            <div class="card" style="flex:1; min-height:300px;">
                <div
                    style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; color:#555;">
                    <span>ğŸ“œ ì…ì¶œê¸ˆ ë‚´ì—­</span>
                    <span id="monthly-total">0ì›</span>
                </div>
                <div id="ledger-list" style="overflow-y: auto;"></div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ë¶„ì„ -->
        <div id="right-panel">
            <!-- ìì‚° + ëª©í‘œ ë°” -->
            <div class="card">
                <div style="color:var(--text-sub); font-size:0.9rem; margin-bottom:5px;">í˜„ì¬ ìì‚°</div>
                <div style="font-size:1.8rem; font-weight:800;">
                    <span id="current-cash">0</span>ì›
                </div>
                <div style="margin-top:12px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#888;">
                        <span>ëª©í‘œ ì”ì•¡: <span id="target-display">0</span>ì›</span>
                        <span id="goal-status" style="font-weight:bold;"></span>
                    </div>
                    <div class="goal-bar-bg">
                        <div id="goal-bar-fill" class="goal-bar-fill"></div>
                    </div>
                </div>
            </div>

            <!-- ê³µíœ´ì¼ ì˜ˆì‚° ê´€ë¦¬ -->
            <div class="card">
                <div style="font-weight:bold; margin-bottom:10px; color:#d63031;">ğŸ“… ê³µíœ´ì¼ ìŠ¤ë§ˆíŠ¸ ì˜ˆì‚°</div>
                <div id="holiday-container">
                    <div style="color:#aaa; font-size:0.9rem;">ì´ë‹¬ì€ ê³µíœ´ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>

            <!-- ì°¨íŠ¸ -->
            <div class="card">
                <div style="font-weight:bold; margin-bottom:10px; color:#555;">ğŸ“Š ì¹´í…Œê³ ë¦¬ ë¶„ì„</div>
                <div style="height:180px;">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨: ê³ ì •ì§€ì¶œ + ì…ë ¥ -->
    <div id="bottom-wrapper">
        <!-- ê³ ì •ì§€ì¶œ ê´€ë¦¬ / ê°œë³„ í‚¤ -->
        <div id="fixed-manage-bar">
            <span>ğŸ“Œ ê³ ì • ì§€ì¶œ ê´€ë¦¬</span>
            <div>
                <button onclick="applyFixedExpenses()"
                    style="background:#eee; border:none; padding:4px 8px; border-radius:6px; cursor:pointer; margin-right:5px;">ì´ë²ˆë‹¬
                    ì¼ê´„ ì ìš©</button>
                <button onclick="openFixedModal()"
                    style="background:var(--text-main); color:white; border:none; padding:4px 8px; border-radius:6px; cursor:pointer;">í¸ì§‘</button>
            </div>
        </div>
        <div id="fixed-quick-row"></div>

        <!-- ì…ë ¥ í¼ -->
        <div id="input-form">
            <input type="date" id="input-date" class="input-box" style="width: 140px;">
            <select id="input-type" class="input-box" style="width:90px;" onchange="updateCategoryOptions()">
                <option value="expense">ì§€ì¶œ</option>
                <option value="income">ì…ê¸ˆ</option>
            </select>
            <select id="input-cat" class="input-box" style="width: 90px;"></select>
            <input type="text" id="input-desc" class="input-box" placeholder="ë‚´ì—­" style="flex:1;">
            <input type="tel" id="input-amt" class="input-box" placeholder="ê¸ˆì•¡" style="width:100px; text-align:right;">
            <button class="btn-submit" onclick="addTransaction()">ë“±ë¡</button>
        </div>
    </div>

    <!-- ì‹œì‘ ëª¨ë‹¬ -->
    <div id="start-modal" class="overlay">
        <div class="center-card">
            <h2>ğŸ’° 2025 ê°€ê³„ë¶€</h2>
            <input type="number" id="init-budget" class="input-box" placeholder="ì‹œì‘ ìì‚°"
                style="width:100%; margin:5px 0;">
            <input type="number" id="init-target" class="input-box" placeholder="ì›” ëª©í‘œ ì”ì•¡"
                style="width:100%; margin:5px 0;">
            <button class="modal-btn" onclick="startApp()">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <!-- ê³ ì •ì§€ì¶œ ëª¨ë‹¬ -->
    <div id="fixed-modal" class="overlay">
        <div class="center-card">
            <h3>ğŸ“Œ ê³ ì • ì§€ì¶œ í¸ì§‘</h3>
            <div id="fixed-list" class="modal-list"></div>
            <div style="display:flex; gap:5px;">
                <input id="new-fixed-name" class="input-box" placeholder="ì´ë¦„" style="flex:1;">
                <input id="new-fixed-amt" type="number" class="input-box" placeholder="ê¸ˆì•¡" style="width:80px;">
            </div>
            <button onclick="addFixedItem()" class="modal-btn" style="margin-top:10px;">ì¶”ê°€</button>
            <button onclick="document.getElementById('fixed-modal').style.display='none'" class="modal-btn"
                style="background:#eee; color:#333;">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        const YEAR = 2025;
        const HOLIDAYS = { 1: [1, 27, 28, 29, 30], 3: [1, 3], 5: [5, 6], 6: [6], 8: [15], 10: [3, 5, 6, 7, 8, 9], 12: [25] };
        const HOLIDAY_NAMES = {
            "1-1": "ì‹ ì •", "1-27": "ì„¤ë‚ ", "1-28": "ì„¤ë‚ ", "1-29": "ì„¤ë‚ ", "1-30": "ëŒ€ì²´ê³µíœ´ì¼",
            "3-1": "ì‚¼ì¼ì ˆ", "3-3": "ëŒ€ì²´ê³µíœ´ì¼", "5-5": "ì–´ë¦°ì´ë‚ ", "5-6": "ì„ê°€íƒ„ì‹ ì¼", "6-6": "í˜„ì¶©ì¼",
            "8-15": "ê´‘ë³µì ˆ", "10-3": "ê°œì²œì ˆ", "10-5": "ì¶”ì„", "10-6": "ì¶”ì„", "10-7": "ì¶”ì„", "10-8": "ëŒ€ì²´ê³µíœ´ì¼", "10-9": "í•œê¸€ë‚ ", "12-25": "ì„±íƒ„ì ˆ"
        };

        let state = {
            budget: 0, target: 0, cash: 0,
            transactions: [],
            fixedExpenses: [{ name: 'ë„·í”Œë¦­ìŠ¤', amount: 17000 }, { name: 'ì›”ì„¸', amount: 500000 }],
            holidayBudgets: {}      // "2025-01-27": 50000
        };
        let currentMonth = new Date().getMonth() + 1;
        let myChart = null;

        window.onload = () => {
            const saved = localStorage.getItem('ledger_2025_pro_v2');
            if (saved) {
                state = JSON.parse(saved);
                if (state.budget > 0) document.getElementById('start-modal').style.display = 'none';
            } else {
                document.getElementById('start-modal').style.display = 'flex';
            }

            document.getElementById('input-date').value = new Date().toISOString().substring(0, 10);
            updateCategoryOptions();
            renderMonthNav();
            initApp();
            renderFixedQuickRow();
        };

        function saveData() { localStorage.setItem('ledger_2025_pro_v2', JSON.stringify(state)); }
        function resetData() { if (confirm("ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { localStorage.removeItem('ledger_2025_pro_v2'); location.reload(); } }

        function startApp() {
            const b = parseInt(document.getElementById('init-budget').value);
            const t = parseInt(document.getElementById('init-target').value);
            if (!b || !t) return alert("ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
            state.budget = b; state.cash = b; state.target = t;
            saveData();
            document.getElementById('start-modal').style.display = 'none';
            initApp();
        }

        function initApp() { setMonth(currentMonth); }

        /* ê³µí†µ UI ì—…ë°ì´íŠ¸: ì”ì•¡ + ëª©í‘œ ë°” */
        function updateGoalAndCashUI() {
            document.getElementById('current-cash').textContent = state.cash.toLocaleString();
            document.getElementById('target-display').textContent = state.target.toLocaleString();
            const status = document.getElementById('goal-status');
            const bar = document.getElementById('goal-bar-fill');

            if (!state.target || state.target <= 0) {
                status.textContent = '';
                bar.style.width = '0%';
                return;
            }

            const gap = state.cash - state.target;
            if (gap >= 0) {
                status.textContent = `ëª©í‘œ ë‹¬ì„±! (+${gap.toLocaleString()})`;
                status.style.color = '#22c55e';
                bar.style.width = '100%';
                bar.style.background = '#22c55e';
            } else {
                status.textContent = `${Math.abs(gap).toLocaleString()}ì› ë¶€ì¡±`;
                status.style.color = '#ef4444';
                const ratio = Math.max(0, Math.min(100, (state.cash / state.target) * 100));
                bar.style.width = `${ratio}%`;
                bar.style.background = '#ef4444';
            }
        }

        /* ìƒë‹¨ ì›” ë„¤ë¹„ */
        function renderMonthNav() {
            const area = document.getElementById('month-scroll-area'); area.innerHTML = '';
            for (let i = 1; i <= 12; i++) {
                const btn = document.createElement('button'); btn.className = `month-btn ${i === currentMonth ? 'active' : ''}`;
                btn.textContent = `${i}ì›”`; btn.onclick = () => setMonth(i);
                area.appendChild(btn);
            }
        }

        function setMonth(m) {
            currentMonth = m;
            renderMonthNav();
            renderCalendar(m);
            renderLedger(m);
            renderChart();
            renderHolidayBoxes(m);
            updateGoalAndCashUI();
        }

        /* ìº˜ë¦°ë” */
        function renderCalendar(month) {
            const grid = document.getElementById('calendar-grid'); grid.innerHTML = '';
            document.getElementById('calendar-header').textContent = `${month}ì›”`;
            ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].forEach(d => grid.innerHTML += `<div class="cal-day-name">${d}</div>`);

            const firstDay = new Date(YEAR, month - 1, 1).getDay();
            const lastDate = new Date(YEAR, month, 0).getDate();
            const hDays = HOLIDAYS[month] || [];

            for (let i = 0; i < firstDay; i++) grid.innerHTML += `<div></div>`;

            for (let d = 1; d <= lastDate; d++) {
                const dateStr = `${YEAR}-${String(month).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const hasEvent = state.transactions.some(t => t.date === dateStr);
                const el = document.createElement('div');
                el.className = `cal-date ${hDays.includes(d) ? 'holiday' : ''} ${hasEvent ? 'has-event' : ''}`;
                el.textContent = d;
                el.onclick = () => {
                    document.querySelectorAll('.cal-date').forEach(c => c.classList.remove('selected'));
                    el.classList.add('selected');
                    document.getElementById('input-date').value = dateStr;
                };
                grid.appendChild(el);
            }
        }

        /* ë‚´ì—­ */
        function renderLedger(month) {
            const list = document.getElementById('ledger-list'); list.innerHTML = '';
            const monthlyData = state.transactions
                .filter(t => parseInt(t.date.split('-')[1]) === month)
                .sort((a, b) => b.date.localeCompare(a.date));

            let total = 0;
            monthlyData.forEach(t => {
                if (t.type === 'expense') total += t.amount;
                const row = document.createElement('div'); row.className = 'ledger-item';
                row.innerHTML = `
                    <span style="color:#888; font-size:0.8rem;">${parseInt(t.date.split('-')[2])}ì¼</span>
                    <span style="flex:1; margin-left:10px;">${t.desc}</span>
                    <span class="${t.type === 'income' ? 'amt-inc' : 'amt-exp'}">
                        ${t.type === 'income' ? '+' : '-'}${t.amount.toLocaleString()}
                    </span>
                `;
                list.appendChild(row);
            });
            document.getElementById('monthly-total').textContent = `ì´ ì§€ì¶œ: ${total.toLocaleString()}ì›`;
        }

        /* ê³µíœ´ì¼ ë°•ìŠ¤ + ì˜ˆì‚° */
        function renderHolidayBoxes(month) {
            const container = document.getElementById('holiday-container');
            container.innerHTML = '';
            const hDays = HOLIDAYS[month];

            if (!hDays || hDays.length === 0) {
                container.innerHTML = '<div style="color:#aaa; padding:10px; text-align:center;">ì´ë²ˆ ë‹¬ì€ ê³µíœ´ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            hDays.forEach(day => {
                const dateKey = `${YEAR}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const name = HOLIDAY_NAMES[`${month}-${day}`] || "ê³µíœ´ì¼";
                const budget = state.holidayBudgets[dateKey] || 0;
                let spent = 0;
                state.transactions.forEach(t => {
                    if (t.date === dateKey && t.type === 'expense') spent += t.amount;
                });
                const remain = budget - spent;
                const percent = budget > 0 ? Math.min(100, (spent / budget) * 100) : 0;

                const box = document.createElement('div');
                box.className = 'holiday-box';
                box.innerHTML = `
                    <div class="holiday-header">
                        <div class="holiday-title">
                            ${name} <span class="holiday-date-badge">${month}/${day}</span>
                        </div>
                        <div style="font-size:0.8rem; font-weight:bold; color:${remain < 0 ? 'red' : '#555'}">
                            ${budget > 0 ? (remain >= 0 ? remain.toLocaleString() + 'ì› ë‚¨ìŒ' : Math.abs(remain).toLocaleString() + 'ì› ì´ˆê³¼') : 'ì˜ˆì‚° ë¯¸ì„¤ì •'}
                        </div>
                    </div>
                    ${budget > 0 ? `
                        <div class="holiday-progress">
                            <div class="holiday-bar" style="width:${percent}%; background:${percent > 100 ? '#d63031' : '#e17055'}"></div>
                        </div>
                        <div class="holiday-stat">
                            <span>ì‚¬ìš©: ${spent.toLocaleString()}ì›</span>
                            <span>ëª©í‘œ: ${budget.toLocaleString()}ì›</span>
                        </div>
                    ` : ''}
                    <div class="h-input-area">
                        <input type="number" id="hb-${dateKey}" class="h-input" placeholder="ëª©í‘œ ê¸ˆì•¡" value="${budget || ''}">
                        <button class="h-btn" onclick="saveHolidayBudget('${dateKey}')">ì„¤ì •</button>
                    </div>
                `;
                container.appendChild(box);
            });
        }

        function saveHolidayBudget(dateKey) {
            const input = document.getElementById(`hb-${dateKey}`);
            const val = parseInt(input.value);
            if (isNaN(val)) return;
            state.holidayBudgets[dateKey] = val;
            saveData();
            renderHolidayBoxes(currentMonth);
        }

        /* ì°¨íŠ¸ */
        function renderChart() {
            if (myChart) myChart.destroy();
            const ctx = document.getElementById('expenseChart').getContext('2d');
            const mData = state.transactions.filter(t => parseInt(t.date.split('-')[1]) === currentMonth && t.type === 'expense');
            let cats = { food: 0, trans: 0, shop: 0, etc: 0, fixed: 0 };
            mData.forEach(t => { if (cats[t.cat] !== undefined) cats[t.cat] += t.amount; else cats['etc'] += t.amount; });

            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ì‹ë¹„', 'êµí†µ', 'ì‡¼í•‘', 'ê¸°íƒ€', 'ê³ ì •'],
                    datasets: [{
                        data: [cats.food, cats.trans, cats.shop, cats.etc, cats.fixed],
                        backgroundColor: ['#ff7675', '#ffeaa7', '#74b9ff', '#a29bfe', '#dfe6e9'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'right', labels: { boxWidth: 10, font: { size: 11 } } } }
                }
            });
        }

        /* ì…ë ¥ */
        function updateCategoryOptions() {
            const t = document.getElementById('input-type').value;
            const c = document.getElementById('input-cat');
            c.innerHTML = t === 'expense'
                ? `<option value="food">ì‹ë¹„</option><option value="trans">êµí†µ</option><option value="shop">ì‡¼í•‘</option><option value="etc">ê¸°íƒ€</option>`
                : `<option value="salary">ì›”ê¸‰</option><option value="etc">ê¸°íƒ€</option>`;
        }

        function addTransaction() {
            const date = document.getElementById('input-date').value;
            const type = document.getElementById('input-type').value;
            const cat = document.getElementById('input-cat').value;
            const desc = document.getElementById('input-desc').value;
            const amt = parseInt(document.getElementById('input-amt').value);
            if (!date || !desc || !amt) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");

            state.transactions.push({ date, type, cat, desc, amount: amt });
            state.cash += (type === 'income' ? amt : -amt);
            saveData();

            document.getElementById('input-desc').value = '';
            document.getElementById('input-amt').value = '';
            setMonth(parseInt(date.split('-')[1]));
        }

        /* ê³ ì • ì§€ì¶œ ê°œë³„ í‚¤/ëª¨ë‹¬ */
        function renderFixedQuickRow() {
            const row = document.getElementById('fixed-quick-row');
            row.innerHTML = '';
            if (state.fixedExpenses.length === 0) {
                row.innerHTML = '<span style="font-size:0.8rem; color:#aaa;">ë“±ë¡ëœ ê³ ì •ì§€ì¶œì´ ì—†ìŠµë‹ˆë‹¤.</span>';
                return;
            }
            state.fixedExpenses.forEach((item, idx) => {
                const btn = document.createElement('button');
                btn.className = 'fixed-chip';
                btn.textContent = `${item.name} (${item.amount.toLocaleString()}ì›)`;
                btn.onclick = () => applySingleFixed(idx);
                row.appendChild(btn);
            });
        }

        function applySingleFixed(idx) {
            const item = state.fixedExpenses[idx];
            const dateVal = document.getElementById('input-date').value || new Date().toISOString().substring(0, 10);
            state.transactions.push({
                date: dateVal,
                type: 'expense',
                cat: 'fixed',
                desc: item.name,
                amount: item.amount
            });
            state.cash -= item.amount;
            saveData();
            setMonth(parseInt(dateVal.split('-')[1]));
        }

        function openFixedModal() {
            const list = document.getElementById('fixed-list');
            list.innerHTML = '';
            state.fixedExpenses.forEach((item, idx) => {
                list.innerHTML += `
                    <div class="modal-item">
                        <span>${item.name} (${item.amount.toLocaleString()}ì›)</span>
                        <span style="color:red; cursor:pointer;" onclick="delFixed(${idx})">ì‚­ì œ</span>
                    </div>`;
            });
            document.getElementById('fixed-modal').style.display = 'flex';
        }

        function addFixedItem() {
            const name = document.getElementById('new-fixed-name').value;
            const amt = parseInt(document.getElementById('new-fixed-amt').value);
            if (!name || !amt) return;
            state.fixedExpenses.push({ name, amount: amt });
            saveData();
            document.getElementById('new-fixed-name').value = '';
            document.getElementById('new-fixed-amt').value = '';
            openFixedModal();
            renderFixedQuickRow();
        }

        function delFixed(idx) {
            state.fixedExpenses.splice(idx, 1);
            saveData();
            openFixedModal();
            renderFixedQuickRow();
        }

        function applyFixedExpenses() {
            if (!confirm(`${currentMonth}ì›” ê³ ì •ì§€ì¶œì„ ëª¨ë‘ ì ìš©í• ê¹Œìš”?`)) return;
            const dateStr = `${YEAR}-${String(currentMonth).padStart(2, '0')}-01`;
            state.fixedExpenses.forEach(f => {
                state.transactions.push({ date: dateStr, type: 'expense', cat: 'fixed', desc: f.name, amount: f.amount });
                state.cash -= f.amount;
            });
            saveData();
            setMonth(currentMonth);
        }
    </script>
</body>

</html>